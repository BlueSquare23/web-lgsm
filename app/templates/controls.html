{% extends "base.html" %}
{% block title %}Web LGSM Server Controls{% endblock %}

{% block content %}

<br/>

<script type="text/javascript">
// Scrolls to bottom of iframe automatically.
// TODO: FIND BETTER SOLUTION.
//setInterval('frames[0].scrollTo(0,9999999)',10);

  function openForm(){
    document.getElementById("sudo_pass_form").style.display = "block";
  }
  
  function closeForm(){
    document.getElementById("sudo_pass_form").style.display = "none";
  }
  
  {% if auto_post == True %}
  // If in auto_post mode, on window load click ai_btn.
  window.addEventListener('load', function(){
    document.getElementById("ai_btn").click();
  })
  {% endif %}
</script>

<div class="container">

  <div class="row">
    <h2 style='color:white'>Output:</h2>
    <iframe style="color:green" id="output_iframe" name="output_iframe" width="100%" height="400px" src="/no_output">
    </iframe>
    <hr>
  </div>

  <br/>
  <h2 style='color:white'>Server Controls for: {{server_name|capitalize}}</h2>
  <hr>

  {% for command in server_commands %}
  <div class="row">
    <div class="col">
    {% if command.short_cmd == "ai" %}
      <button id="ai_btn" class="btn btn-primary open-button" onclick="openForm();">{{command.long_cmd}}</button>

      <div class="form-group form-popup" id="sudo_pass_form" style="color: white">
        <form method="POST" class="" id="sudo_pass_form" target="output_iframe" action="/controls">
          <input type="hidden" id="server" name="server" value="{{server_name}}" class="form-control"/>
          <input type="hidden" id="command" name="command" value="{{command.short_cmd}}" class="form-control"/>
          <label for="sudo_pass" style="color: white">Sudo Password</label>
          <input type="password"
              id="sudo_pass"
              name="sudo_pass"
              class="form-control"
              title="Sudo password is required to install necessary LGSM dependancies."
              placeholder="Please Enter Sudo Password"
              required
          />

          <br/>
          <input onclick='window.scrollTo(0,0);closeForm();' class="btn btn-primary" type="submit" value="Start {{command.long_cmd}}">
        </form>
      </div>
    {% else %}
      <form method="POST" target="output_iframe" action="/controls">
        <input type="hidden" id="server" name="server" value="{{server_name}}" class="form-control"/>
        <input type="hidden" id="command" name="command" value="{{command.short_cmd}}" class="form-control"/>

        <input onclick='window.scrollTo(0,0);closeForm();' class="btn btn-primary" type="submit" value="{{command.long_cmd}}">
      </form>
    {% endif %}
    </div>
    <div class="col" style="color:green">
      {{command.description}}
    </div>
  </div>
  <br/>
  {% endfor %}
</div>
<br/>

<button id="topBtn" onclick='window.scrollTo(0,0);' type="button" 
  class="btn btn-primary d-sm-none d-md-block d-none d-sm-block">
  <a href="#top" style="color: white">/\ Top /\</a>
</button>

<a id="delBtn" title="Remove server entry from web-lgsm database"
  onclick="return confirm('Are you sure you want to delete {{server_name}}?');" class="btn btn-danger"
  href="/delete?server={{server_name}}" role="button">Delete Server</a>

{% endblock %}
