{% extends "base.html" %}
{% block title %}Web LGSM Server Controls{% endblock %}

{% block content %}

      <br />
      <div class="container">
        {% include 'spinners.html' %}

        <div class="row">
          {% include 'xtermjs.html' %}
        </div>
        <br />

        <script src="{{ url_for('static', filename='js/open-close-form.js') }}"></script>

        <!-- Send cmd game server form hidden until openForm onclick -->
        <div class="container bg-dark border border-white p-2 form-group form-popup rounded-3" id="send_cmd_form" style="color: white;">
          <button type="button" class="btn-close p-2 btn-close-white position-absolute top-0 end-0" aria-label="Close" onclick="document.getElementById('send_cmd_form').style.display = 'none'"></button>
          <form method="POST" class="form-group" id="send_cmd_form" action="/controls">
            {{ send_cmd_form.csrf_token }}
            {{ send_cmd_form.send_form(value='true') }}
            {{ send_cmd_form.server_id(value=server_id) }}
            {{ send_cmd_form.control(value='sd') }}
            <label for="cmd" class="pb-2" style="color: white;">Send Command</label>
            {{ send_cmd_form.send_cmd(class="form-control", title="Send cmd to running game server.", placeholder="Please Enter Command") }}

            <input onclick="window.scrollTo(0,0);closeForm('send_cmd_form');" id="send_btn" class="mt-3 mb-2 btn btn-outline-primary" type="submit" value="Send" />
          </form>
        </div>

        {% set parsed_json = user.permissions|from_json %}
        {% if user.role == 'admin' or parsed_json.edit_cfgs %}
          {% if cfg_paths|length %}
            <div class="row">
              <h2>Edit Config(s)</h2>
              <hr />

              {% for cfg_path in cfg_paths %}
                <div class="col">
                  {% set cfg_file = cfg_path.split('/')[-1] %}
                  <a href="/edit?server_id={{server_id}}&cfg_path={{cfg_path}}" role="button" class="btn btn-outline-primary">Edit: {{cfg_file}}</a>
                </div>
                <br />
              {% endfor %}
            </div>
            <br />
          {% endif %}
        {% endif %}

        <br />
        <div class="container text-center">
          <div class="row align-items-start">
            <div class="col">
              <div class="text-center">
                <a href="{{ url_for('main.add', server_id=server_id) }}" role="button" class="text-center btn btn-outline-primary">
                  Edit {{server_name|capitalize}} Settings
                </a>
              </div>
            </div>
          {% if show_jobs_edit %}
            <div class="col">
              <div class="text-center">
                <a href="{{ url_for('main.jobs', server_id=server_id) }}" role="button" class="text-center btn btn-outline-primary">
                  Edit {{server_name|capitalize}} Jobs
                </a>
              </div>
            </div>
          {% endif %}
          </div>
        </div>

        <br />

        <br />
        <h2>Server Controls for {{server_name|capitalize}}</h2>
        <hr />

        {% for control in server_controls %}
          {% if control.short_ctrl == 'sd' %}
          <div class="row">
            <div class="col">
              <button id="send_cmd_btn" class="btn btn-outline-primary open-button" onclick="openForm('{{server_id}}', '{{control.short_ctrl}}', 'send_cmd_form');">{{control.long_ctrl}}</button>
            </div>
          {% else %}
          <div class="row">
            <div class="col">
              <form method="POST" id="ctrls-form" action="/controls">
                {{ controls_form.csrf_token }}
                {{ controls_form.ctrl_form(value='true') }}
                {{ controls_form.server_id(value=server_id) }}
                {{ controls_form.control(value=control.short_ctrl) }}

                <input onclick="window.scrollTo(0,0);showSpinners();" class="btn btn-outline-primary" type="submit" value="{{control.long_ctrl}}" />
              </form>
            </div>
          {% endif %}
            <div class="col text-primary">
              {{control.description}}
            </div>
          </div>
          <br />
        {% endfor %}

      </div>
      <br />

      <!-- Set JS vars from Jinja vars. -->
      <script>
        let serverId = "{{ server_id }}";
        let textColor = "{{ _config.get('aesthetic','text_color') }}";
      {# If show_stderr var True #}
      {% if _config.get('settings','show_stderr') %}
        let showStderr = true;
      {% else %}
        let showStderr = false;
      {% endif %}

      {# If console var True #}
      {% if console is defined and console %}
        let sConsole = true;
      {% else %}
        let sConsole = false;
      {% endif %}
      </script>

      <button id="top-button" onclick="window.scrollTo(0,0);" type="button" style="text-decoration: underline;" class="btn btn-outline-primary d-sm-none d-md-block d-none d-sm-block">
        /\ Top /\
      </button>
      <button id="delete-btn" class="btn btn-outline-danger">Delete Server</button>

      <!-- Import JavaScript -->
      <script src="/static/js/update-xterm.js"></script>
      <script src="/static/js/show-spinners.js"></script>
      <script src="/static/js/show-alert.js"></script>
      <script src="/static/js/delete-btn.js"></script>

      <!-- TODO v1.9: Make config options display on page if debug.
      {# if config.getboolean('debug','debug') #}
        <p>Config Options: {{_config}}</p>
      {# endif #}
      -->
{% endblock %}
